# 如果解压失败，使用这个替代包
wget https://github.com/melak47/dxflib/archive/refs/tags/v2.5.0.0.tar.gz -O dxflib-2.5.0.0.tar.gz
tar -xzf dxflib-2.5.0.0.tar.gz
cd dxflib-2.5.0.0
# 查看目录结构，确定源码位置
# 通常包含以下文件：
# src/ 目录中有 cpp 和 h 文件
# 或者直接有 dl_dxf.h 等文件

# 如果使用 qmake
find . -name "*.pro" -o -name "Makefile" -o -name "CMakeLists.txt"

# 如果找到 .pro 文件
qmake dxflib.pro
make -j$(nproc)

# 如果没有 qmake，手动编译
cd src
g++ -c *.cpp -I. -fPIC
ar rcs libdxflib.a *.o
g++ -shared -o libdxflib.so *.o
# 创建安装目录
sudo mkdir -p /usr/local/include/dxflib
sudo mkdir -p /usr/local/lib

# 复制头文件
sudo cp *.h /usr/local/include/dxflib/
# 或者，如果头文件在 include/ 目录
sudo cp include/*.h /usr/local/include/dxflib/

# 复制库文件
sudo cp libdxflib.* /usr/local/lib/

# 更新库缓存
sudo ldconfig
# 验证头文件位置
find /usr -name "dl_dxf.h" 2>/dev/null
find /usr/local -name "dl_dxf.h" 2>/dev/null

# 验证库文件
find /usr -name "*dxflib*" 2>/dev/null
find /usr/local -name "*dxflib*" 2>/dev/null













# 1. 移除 libdxfrw
cd ~/Packages/libdxfrw/build
sudo make uninstall 2>/dev/null || true

# 手动删除残留文件
sudo rm -rf /usr/local/include/libdxfrw
sudo rm -f /usr/local/lib/libdxfrw.*
sudo rm -f /usr/local/lib/pkgconfig/libdxfrw.pc 2>/dev/null || true

# 2. 移除 dxflib（如果已安装）
sudo rm -rf /usr/local/include/dxflib 2>/dev/null || true
sudo rm -f /usr/local/lib/libdxflib.* 2>/dev/null || true
sudo rm -f /usr/local/lib/pkgconfig/dxflib.pc 2>/dev/null || true

# 3. 清理构建缓存
sudo ldconfig


# 确保在干净的目录
cd ~/Packages

# 删除旧的 libdxfrw 目录（如果有）
rm -rf libdxfrw

# 重新克隆 libdxfrw
git clone https://github.com/LibreCAD/libdxfrw.git
cd libdxfrw

# 查看可用标签，选择稳定版本
git tag -l | sort -V | tail -10

# 如果需要特定版本，可以检出
# git checkout tags/0.8.0  # 例如

# 创建构建目录
mkdir build
cd build

# 配置并安装 libdxfrw
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local \
         -DCMAKE_BUILD_TYPE=Release \
         -DBUILD_TESTING=OFF

# 编译
make -j$(nproc)

# 安装
sudo make install

# 验证安装
echo "=== 验证 libdxfrw 安装 ==="
ls -la /usr/local/include/libdxfrw/
ls -la /usr/local/lib/libdxfrw*

# 检查头文件中是否有 DRW_PlotSettings
grep -r "DRW_PlotSettings" /usr/local/include/libdxfrw/ 2>/dev/null || echo "未找到 DRW_PlotSettings"

# 进入 libdxfrw 源码目录
cd ~/photo_voltatic_ws/Packages/libdxfrw

# 创建头文件目录
sudo mkdir -p /usr/local/include/libdxfrw

# 复制所有头文件
sudo cp src/*.h /usr/local/include/libdxfrw/
sudo cp src/intern/*.h /usr/local/include/libdxfrw/

# 验证头文件安装
echo "=== 验证头文件 ==="
ls -la /usr/local/include/libdxfrw/ | head -20
echo "头文件数量: $(ls /usr/local/include/libdxfrw/*.h 2>/dev/null | wc -l)"


